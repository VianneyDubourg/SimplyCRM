<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimplyCRM - Email WhatsApp Style</title>
    <!-- EmailJS remplacÃ© par backend SMTP direct -->
    <style>
/* Reset et base */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #f0f0f0;
    height: 100vh;
    overflow: hidden;
}

.app {
    display: flex;
    height: 100vh;
    background-color: #f0f0f0;
}

/* Sidebar */
.sidebar {
    width: 350px;
    background-color: #ffffff;
    border-right: 1px solid #e9edef;
    display: flex;
    flex-direction: column;
}

.sidebar-header {
    height: 59px;
    background-color: #f0f2f5;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    border-bottom: 1px solid #e9edef;
}

.user-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    overflow: hidden;
    background-color: #25d366;
    display: flex;
    align-items: center;
    justify-content: center;
}

.user-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.sidebar-actions {
    display: flex;
    gap: 8px;
}

.action-btn {
    width: 40px;
    height: 40px;
    border: none;
    background: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #54656f;
    transition: background-color 0.15s;
}

.action-btn:hover {
    background-color: #e9edef;
}

.search-container {
    padding: 8px 14px;
    background-color: #ffffff;
    border-bottom: 1px solid #e9edef;
}

#searchInput {
    width: 100%;
    padding: 9px 16px;
    border: none;
    border-radius: 8px;
    background-color: #f0f2f5;
    font-size: 14px;
    outline: none;
    color: #111b21;
}

#searchInput::placeholder {
    color: #667781;
}

.conversations-list {
    flex: 1;
    overflow-y: auto;
}

.conversation-item {
    display: flex;
    align-items: center;
    padding: 10px 16px;
    cursor: pointer;
    border-bottom: 1px solid #e9edef;
    transition: background-color 0.15s;
}

.conversation-item:hover {
    background-color: #f5f6f6;
}

.conversation-item.active {
    background-color: #f0f2f5;
}

.conversation-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    margin-right: 12px;
    background-color: #25d366;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.conversation-info {
    flex: 1;
    min-width: 0;
}

.conversation-name {
    font-size: 17px;
    font-weight: 400;
    color: #111b21;
    margin-bottom: 2px;
    line-height: 21px;
}

.conversation-last-message {
    font-size: 14px;
    color: #667781;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 20px;
}

.conversation-time {
    font-size: 12px;
    color: #667781;
    margin-left: 8px;
    white-space: nowrap;
}

/* Chat Container */
.chat-container {
    flex: 1;
    display: flex;
    flex-direction: column;
    background-color: #efeae2;
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100"><defs><pattern id="whatsapp-pattern" x="0" y="0" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="50" cy="50" r="1" fill="%23d4d4d4" opacity="0.4"/></pattern></defs><rect width="100" height="100" fill="url(%23whatsapp-pattern)"/></svg>');
    background-repeat: repeat;
    background-size: 100px 100px;
    position: relative;
}

.chat-header {
    height: 59px;
    background-color: #f0f2f5;
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 16px;
    border-left: 1px solid #e9edef;
    border-bottom: 1px solid #e9edef;
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
}

.chat-info {
    display: flex;
    align-items: center;
}

.contact-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    margin-right: 12px;
    background-color: #25d366;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.contact-details h3 {
    font-size: 16px;
    font-weight: 400;
    color: #111b21;
    margin-bottom: 0;
    line-height: 21px;
}

.contact-details span {
    font-size: 13px;
    color: #667781;
    line-height: 20px;
}

.chat-actions {
    display: flex;
    gap: 8px;
}

.chat-action-btn {
    width: 40px;
    height: 40px;
    border: none;
    background: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #54656f;
    transition: background-color 0.15s;
}

.chat-action-btn:hover {
    background-color: #e9edef;
}

/* Messages */
.messages-container {
    flex: 1;
    padding: 10px 0;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
}

.welcome-message {
    text-align: center;
    margin: auto;
    max-width: 300px;
}

.welcome-message h2 {
    font-size: 24px;
    color: #54656f;
    margin-bottom: 16px;
}

.welcome-message p {
    color: #54656f;
    line-height: 1.5;
}

.message {
    margin-bottom: 2px;
    display: flex;
    flex-direction: column;
    padding: 0 8px;
}

.message.sent {
    align-items: flex-end;
}

.message.received {
    align-items: flex-start;
}

.message-bubble {
    max-width: 65%;
    min-width: 60px;
    padding: 6px 7px 8px 9px;
    border-radius: 7.5px;
    position: relative;
    word-wrap: break-word;
    box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
}

.message.sent .message-bubble {
    background-color: #d9fdd3;
    color: #111b21;
    border-bottom-right-radius: 2px;
}

.message.received .message-bubble {
    background-color: #ffffff;
    color: #111b21;
    border-bottom-left-radius: 2px;
    box-shadow: 0 1px 0.5px rgba(0, 0, 0, 0.13);
}

.message-content {
    font-size: 14.2px;
    line-height: 19px;
    letter-spacing: 0;
    word-wrap: break-word;
    white-space: pre-wrap;
}

.message-time {
    font-size: 11px;
    color: #667781;
    margin-top: 2px;
    margin-left: 4px;
    display: inline-block;
    vertical-align: bottom;
    line-height: 15px;
}

.message.sent .message-time {
    text-align: right;
    float: right;
}

.message.received .message-time {
    text-align: left;
    float: right;
}

/* Message Input */
.message-input-container {
    background-color: #f0f2f5;
    border-top: 1px solid #e9edef;
    padding: 0;
}

.subject-input-wrapper {
    padding: 8px 8px 4px 8px;
    display: block;
    transition: all 0.2s ease-out;
}

.subject-input-container {
    padding: 0;
}

.subject-input-container input {
    width: 100%;
    padding: 7px 12px;
    border: none;
    border-radius: 8px;
    background-color: #ffffff;
    font-size: 13px;
    outline: none;
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.04);
    color: #111b21;
    transition: all 0.15s;
    font-family: inherit;
}

.subject-input-container input::placeholder {
    color: #667781;
    font-style: italic;
    font-size: 13px;
}

.subject-input-container input:focus {
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.08);
    background-color: #ffffff;
}

.message-input-wrapper {
    display: flex;
    align-items: flex-end;
    padding: 6px 8px 8px 8px;
    gap: 8px;
    background-color: #f0f2f5;
}

.input-actions {
    display: flex;
    gap: 0;
    align-items: center;
    flex-shrink: 0;
}

.input-action-btn {
    width: 44px;
    height: 44px;
    border: none;
    background: none;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #54656f;
    transition: all 0.15s;
    flex-shrink: 0;
    margin-right: 4px;
}

.input-action-btn:hover {
    background-color: #e9edef;
}

.input-action-btn:active {
    transform: scale(0.95);
}

.message-input {
    display: flex;
    align-items: flex-end;
    gap: 8px;
    flex: 1;
    background-color: #ffffff;
    border-radius: 21px;
    padding: 6px 2px 6px 12px;
    box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
    min-height: 60px;
}

.message-input textarea {
    flex: 1;
    padding: 4px 0;
    border: none;
    background: transparent;
    font-size: 15px;
    outline: none;
    color: #111b21;
    min-height: 48px;
    max-height: 200px;
    resize: none;
    line-height: 20px;
    font-family: inherit;
    overflow-y: auto;
}

.message-input textarea::-webkit-scrollbar {
    width: 4px;
}

.message-input textarea::-webkit-scrollbar-track {
    background: transparent;
}

.message-input textarea::-webkit-scrollbar-thumb {
    background: #cccccc;
    border-radius: 2px;
}

.message-input textarea::-webkit-scrollbar-thumb:hover {
    background: #aaaaaa;
}

.message-input textarea::placeholder {
    color: #667781;
}

.send-btn {
    width: 40px;
    height: 40px;
    border: none;
    border-radius: 50%;
    background-color: #25d366;
    color: white;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.15s;
    flex-shrink: 0;
    box-shadow: none;
    margin-bottom: 4px;
}

.send-btn:hover {
    background-color: #20ba5a;
    transform: scale(1.05);
}

.send-btn:active {
    transform: scale(0.95);
}

.message-input:has(textarea:not(:placeholder-shown)) .send-btn {
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* Modals */
.modal {
    display: none;
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.4);
    backdrop-filter: blur(2px);
}

.modal-content {
    background-color: #ffffff;
    margin: 5% auto;
    padding: 0;
    border-radius: 12px;
    width: 90%;
    max-width: 520px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
    overflow: hidden;
    animation: modalSlideIn 0.2s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.modal-header {
    padding: 20px 24px;
    border-bottom: 1px solid #e9edef;
    display: flex;
    justify-content: space-between;
    align-items: center;
    background-color: #f0f2f5;
}

.modal-header h3 {
    margin: 0;
    font-size: 17px;
    font-weight: 400;
    color: #111b21;
    line-height: 21px;
}

.close-modal {
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #667781;
    padding: 0;
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background-color 0.15s;
}

.close-modal:hover {
    background-color: #e9edef;
}

.modal-body {
    padding: 24px;
    background-color: #ffffff;
}

/* Template Form */
.template-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-bottom: 24px;
    padding-bottom: 24px;
    border-bottom: 1px solid #e9edef;
}

.template-form > div {
    display: flex;
    flex-direction: column;
}

.template-form label {
    font-size: 14px;
    color: #667781;
    font-weight: 400;
    margin-bottom: 4px;
    display: block;
}

.template-form input,
.template-form textarea {
    width: 100%;
    padding: 12px 16px;
    margin-bottom: 0;
    border: 1px solid #e9edef;
    border-radius: 8px;
    font-size: 15px;
    outline: none;
    background-color: #ffffff;
    color: #111b21;
    font-family: inherit;
    transition: border-color 0.15s;
}

.template-form input::placeholder,
.template-form textarea::placeholder {
    color: #667781;
}

.template-form input:hover,
.template-form textarea:hover {
    border-color: #d1d7db;
}

.template-form input:focus,
.template-form textarea:focus {
    border-color: #25d366;
    box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.1);
}

.template-form textarea {
    min-height: 120px;
    resize: vertical;
    line-height: 20px;
}

.template-form button {
    background-color: #25d366;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 24px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 500;
    transition: all 0.15s;
    width: 100%;
    margin-top: 8px;
    box-shadow: 0 2px 4px rgba(37, 211, 102, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

.template-form button:hover {
    background-color: #20ba5a;
    box-shadow: 0 4px 8px rgba(37, 211, 102, 0.3);
    transform: translateY(-1px);
}

.template-form button:active {
    transform: translateY(0);
    box-shadow: 0 1px 2px rgba(37, 211, 102, 0.2);
}

.templates-list-container {
    margin-top: 8px;
}

.templates-list-container h4 {
    font-size: 15px;
    font-weight: 400;
    color: #111b21;
    margin: 0 0 12px 0;
}

.templates-list {
    max-height: 350px;
    overflow-y: auto;
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.template-item {
    padding: 14px 16px;
    border: 1px solid #e9edef;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.15s;
    background-color: #ffffff;
    animation: templateSlideIn 0.2s ease-out;
}

@keyframes templateSlideIn {
    from {
        opacity: 0;
        transform: translateY(-5px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.template-item:hover {
    background-color: #f0f2f5;
    border-color: #d1d7db;
    transform: translateX(2px);
}

.template-item:active {
    transform: translateX(0);
}

.template-name {
    font-weight: 500;
    font-size: 15px;
    margin-bottom: 6px;
    color: #111b21;
    line-height: 20px;
}

.template-preview {
    font-size: 13px;
    color: #667781;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    line-height: 18px;
}

.template-empty {
    padding: 40px 20px;
    text-align: center;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 200px;
}

/* Broadcast Form */
.broadcast-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.broadcast-form label {
    font-size: 14px;
    color: #667781;
    font-weight: 400;
    margin-bottom: 4px;
    display: block;
}

.broadcast-form select {
    width: 100%;
    padding: 12px 16px;
    margin-bottom: 0;
    border: 1px solid #e9edef;
    border-radius: 8px;
    font-size: 15px;
    outline: none;
    background-color: #ffffff;
    color: #111b21;
    cursor: pointer;
    transition: border-color 0.15s;
    appearance: none;
    background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 12 12"><path fill="%23667781" d="M6 9L1 4h10z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 12px center;
    padding-right: 40px;
}

.broadcast-form select:hover {
    border-color: #d1d7db;
}

.broadcast-form select:focus {
    border-color: #25d366;
    box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.1);
}

.broadcast-form textarea {
    width: 100%;
    min-height: 120px;
    padding: 12px 16px;
    margin-bottom: 0;
    border: 1px solid #e9edef;
    border-radius: 8px;
    font-size: 15px;
    outline: none;
    background-color: #ffffff;
    color: #111b21;
    resize: vertical;
    font-family: inherit;
    line-height: 20px;
    transition: border-color 0.15s;
}

.broadcast-form textarea::placeholder {
    color: #667781;
}

.broadcast-form textarea:hover {
    border-color: #d1d7db;
}

.broadcast-form textarea:focus {
    border-color: #25d366;
    box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.1);
}

.broadcast-form button {
    background-color: #25d366;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 24px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 500;
    transition: all 0.15s;
    width: 100%;
    margin-top: 8px;
    box-shadow: 0 2px 4px rgba(37, 211, 102, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

.broadcast-form button:hover:not(:disabled) {
    background-color: #20ba5a;
    box-shadow: 0 4px 8px rgba(37, 211, 102, 0.3);
    transform: translateY(-1px);
}

.broadcast-form button:active:not(:disabled) {
    transform: translateY(0);
    box-shadow: 0 1px 2px rgba(37, 211, 102, 0.2);
}

.broadcast-form button:disabled {
    cursor: not-allowed;
    opacity: 0.6;
}

.broadcast-results {
    margin-top: 24px;
    padding-top: 20px;
    border-top: 1px solid #e9edef;
}

.broadcast-results h4 {
    font-size: 15px;
    font-weight: 400;
    color: #111b21;
    margin: 0 0 12px 0;
}

.result-item {
    padding: 10px 14px;
    margin-bottom: 6px;
    border-radius: 8px;
    font-size: 14px;
    line-height: 20px;
    display: flex;
    align-items: center;
    gap: 8px;
    animation: resultSlideIn 0.2s ease-out;
}

@keyframes resultSlideIn {
    from {
        opacity: 0;
        transform: translateX(-10px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

.result-item.success {
    background-color: #d9fdd3;
    color: #111b21;
    border-left: 3px solid #25d366;
}

.result-item.error {
    background-color: #ffeaea;
    color: #d93025;
    border-left: 3px solid #d93025;
}

.result-item::before {
    content: '';
    width: 8px;
    height: 8px;
    border-radius: 50%;
    flex-shrink: 0;
}

.result-item.success::before {
    background-color: #25d366;
}

.result-item.error::before {
    background-color: #d93025;
}

/* New Chat Form */
.new-chat-form {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.new-chat-form > div {
    display: flex;
    flex-direction: column;
}

.new-chat-form label {
    font-size: 14px;
    color: #667781;
    font-weight: 400;
    margin-bottom: 4px;
    display: block;
}

.new-chat-form input {
    width: 100%;
    padding: 12px 16px;
    margin-bottom: 0;
    border: 1px solid #e9edef;
    border-radius: 8px;
    font-size: 15px;
    outline: none;
    background-color: #ffffff;
    color: #111b21;
    font-family: inherit;
    transition: border-color 0.15s;
}

.new-chat-form input::placeholder {
    color: #667781;
}

.new-chat-form input:hover {
    border-color: #d1d7db;
}

.new-chat-form input:focus {
    border-color: #25d366;
    box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.1);
}

.new-chat-form button {
    background-color: #25d366;
    color: white;
    border: none;
    padding: 12px 24px;
    border-radius: 24px;
    cursor: pointer;
    font-size: 15px;
    font-weight: 500;
    transition: all 0.15s;
    width: 100%;
    margin-top: 8px;
    box-shadow: 0 2px 4px rgba(37, 211, 102, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
}

.new-chat-form button:hover {
    background-color: #20ba5a;
    box-shadow: 0 4px 8px rgba(37, 211, 102, 0.3);
    transform: translateY(-1px);
}

.new-chat-form button:active {
    transform: translateY(0);
    box-shadow: 0 1px 2px rgba(37, 211, 102, 0.2);
}

/* Responsive */
@media (max-width: 768px) {
    .sidebar {
        width: 100%;
        position: absolute;
        z-index: 10;
        left: -100%;
        transition: left 0.3s;
    }

    .sidebar.open {
        left: 0;
    }

    .chat-container {
        width: 100%;
    }
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.message {
    animation: fadeIn 0.3s ease-out;
}

/* Scrollbar styling */
.messages-container::-webkit-scrollbar,
.conversations-list::-webkit-scrollbar,
.templates-list::-webkit-scrollbar {
    width: 6px;
}

.messages-container::-webkit-scrollbar-track,
.conversations-list::-webkit-scrollbar-track,
.templates-list::-webkit-scrollbar-track {
    background: transparent;
}

.messages-container::-webkit-scrollbar-thumb,
.conversations-list::-webkit-scrollbar-thumb,
.templates-list::-webkit-scrollbar-thumb {
    background: #cccccc;
    border-radius: 3px;
}

.messages-container::-webkit-scrollbar-thumb:hover,
.conversations-list::-webkit-scrollbar-thumb:hover,
.templates-list::-webkit-scrollbar-thumb:hover {
    background: #aaaaaa;
}

/* Configuration section */
.config-section {
    padding: 20px;
    background-color: #f8f9fa;
    border-bottom: 1px solid #e0e0e0;
    display: none;
}

.config-section.show {
    display: block;
}

.config-form {
    max-width: 400px;
}

.config-form input {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
    border: 1px solid #ddd;
    border-radius: 4px;
}

.config-form button {
    background-color: #25d366;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
}

.config-form button:hover {
    background-color: #20ba5a;
}
    </style>
</head>
<body>
    <div class="app" id="mainApp">
        <!-- Sidebar gauche -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="user-avatar">
                    <span>VS</span>
                </div>
                <div class="sidebar-actions">
                    <button id="newChatBtn" class="action-btn" title="Nouvelle conversation">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                    </button>
                    <button id="templatesBtn" class="action-btn" title="Templates">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        </svg>
                    </button>
                    <button id="broadcastBtn" class="action-btn" title="Envoi en masse">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2M12,4A8,8 0 0,1 20,12A8,8 0 0,1 12,20A8,8 0 0,1 4,12A8,8 0 0,1 12,4M11,6V8H13V6H11M11,10V18H13V10H11Z"/>
                        </svg>
                    </button>
                </div>
            </div>

            <div class="search-container">
                <input type="text" id="searchInput" placeholder="Rechercher des conversations...">
            </div>

            <div class="conversations-list" id="conversationsList">
                <!-- Les conversations seront ajoutÃ©es dynamiquement -->
            </div>
        </div>

        <!-- Zone principale du chat -->
        <div class="chat-container">
            <div class="chat-header">
                <div class="chat-info">
                    <div class="contact-avatar">
                        <span>C</span>
                    </div>
                    <div class="contact-details">
                        <h3 id="contactName">SÃ©lectionnez une conversation</h3>
                        <span id="contactEmail">email@exemple.com</span>
                    </div>
                </div>
            </div>

            <div class="messages-container" id="messagesContainer">
                <div class="welcome-message">
                    <h2>ðŸ‘‹ Bienvenue sur SimplyCRM</h2>
                    <p>SÃ©lectionnez une conversation ou crÃ©ez-en une nouvelle pour commencer Ã  envoyer des emails.</p>
                </div>
            </div>

            <div class="message-input-container">
                <div class="subject-input-wrapper">
                    <div class="subject-input-container">
                        <input type="text" id="subjectInput" placeholder="Objet du mail (optionnel)">
                    </div>
                </div>
                <div class="message-input-wrapper">
                    <div class="input-actions">
                        <button id="attachBtn" class="input-action-btn" title="PiÃ¨ce jointe">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M16.5,6V17.5A4,4 0 0,1 12.5,21.5A4,4 0 0,1 8.5,17.5V5A2.5,2.5 0 0,1 11,2.5A2.5,2.5 0 0,1 13.5,5V15.5A1,1 0 0,1 12.5,16.5A1,1 0 0,1 11.5,15.5V6H10V15.5A2.5,2.5 0 0,0 12.5,18A2.5,2.5 0 0,0 15,15.5V5A4,4 0 0,0 7,5V17.5A5.5,5.5 0 0,0 12.5,23A5.5,5.5 0 0,0 18,17.5V6H16.5Z"/>
                            </svg>
                        </button>
                        <button id="templateQuickBtn" class="input-action-btn" title="Templates rapides">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                            </svg>
                        </button>
                    </div>
                    <div class="message-input">
                        <textarea id="messageInput" placeholder="Tapez un message" rows="3"></textarea>
                        <button id="sendBtn" class="send-btn" title="Envoyer">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal pour les templates -->
        <div id="templatesModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Templates d'emails</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="template-form">
                        <div>
                            <label for="templateName">Nom du template</label>
                            <input type="text" id="templateName" placeholder="Ex: Salutation client">
                        </div>
                        <div>
                            <label for="templateContent">Contenu du template</label>
                            <textarea id="templateContent" placeholder="Bonjour {prenom},&#10;&#10;Merci pour votre intÃ©rÃªt.&#10;&#10;Cordialement,&#10;Vianney Stelneo&#10;&#10;Variables disponibles: {nom}, {prenom}, {nom_complet}, {email}"></textarea>
                        </div>
                        <button id="saveTemplateBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; vertical-align: middle;">
                                <path d="M15,9H5V5H15M12,19A3,3 0 0,1 9,19A3,3 0 0,1 12,16A3,3 0 0,1 15,19M19,3H5C3.89,3 3,3.9 3,5V19A2,2 0 0,0 5,21H19A2,2 0 0,0 21,19V5C21,3.9 20.1,3 19,3Z"/>
                            </svg>
                            Sauvegarder le template
                        </button>
                    </div>
                    <div class="templates-list-container">
                        <h4>Templates sauvegardÃ©s</h4>
                        <div class="templates-list" id="templatesList">
                            <!-- Templates seront ajoutÃ©s ici -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal pour broadcast -->
        <div id="broadcastModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Envoi en masse</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="broadcast-form">
                        <div>
                            <label for="broadcastTemplate">Template Ã  utiliser</label>
                            <select id="broadcastTemplate">
                                <option value="">Choisir un template</option>
                            </select>
                        </div>
                        <div>
                            <label for="broadcastEmails">Liste des emails</label>
                            <textarea id="broadcastEmails" placeholder="Entrez les emails sÃ©parÃ©s par des virgules ou sauts de ligne&#10;Exemple:&#10;client1@email.com&#10;client2@email.com&#10;client3@email.com"></textarea>
                        </div>
                        <button id="sendBroadcastBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; vertical-align: middle;">
                                <path d="M2,21L23,12L2,3V10L17,12L2,14V21Z"/>
                            </svg>
                            Envoyer Ã  tous
                        </button>
                    </div>
                    <div class="broadcast-results" id="broadcastResults" style="display: none;">
                        <h4>RÃ©sultats de l'envoi</h4>
                        <!-- RÃ©sultats de l'envoi -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal pour nouveau chat -->
        <div id="newChatModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Nouvelle conversation</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="new-chat-form">
                        <div>
                            <label for="newContactName">Nom du contact</label>
                            <input type="text" id="newContactName" placeholder="Ex: Jean Dupont">
                        </div>
                        <div>
                            <label for="newContactEmail">Adresse email</label>
                            <input type="email" id="newContactEmail" placeholder="Ex: jean.dupont@email.com">
                        </div>
                        <button id="createChatBtn">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="margin-right: 8px; vertical-align: middle;">
                                <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
                                <path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
                            </svg>
                            CrÃ©er la conversation
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
// Configuration API Backend SMTP - DÃ©tection automatique de l'environnement
const isLocal = window.location.hostname === 'localhost' || 
                window.location.hostname === '127.0.0.1' ||
                window.location.hostname.includes('localhost');
const isVercel = window.location.hostname.includes('vercel.app') || 
                 window.location.hostname.includes('vercel.com');
const API_URL = isLocal ? 'http://localhost:3000/api' : '/api';

// Variables globales
let conversations = JSON.parse(localStorage.getItem('conversations')) || [];
let templates = JSON.parse(localStorage.getItem('templates')) || [];
let currentConversationId = null;
let isBroadcastMode = false;

// Ã‰lÃ©ments DOM
const mainApp = document.getElementById('mainApp');
const conversationsList = document.getElementById('conversationsList');
const messagesContainer = document.getElementById('messagesContainer');
const messageInput = document.getElementById('messageInput');
const sendBtn = document.getElementById('sendBtn');
const contactName = document.getElementById('contactName');
const contactEmail = document.getElementById('contactEmail');
const searchInput = document.getElementById('searchInput');

// Fonctions utilitaires
function saveToLocalStorage() {
    localStorage.setItem('conversations', JSON.stringify(conversations));
    localStorage.setItem('templates', JSON.stringify(templates));
}

function generateId() {
    return Date.now().toString(36) + Math.random().toString(36).substr(2);
}

function formatTime(date) {
    return new Date(date).toLocaleTimeString('fr-FR', {
        hour: '2-digit',
        minute: '2-digit'
    });
}

function getInitials(name) {
    return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
}

function replaceTemplateVariables(template, contact) {
    let content = template;
    const variables = {
        '{nom}': contact.name.split(' ').pop() || '',
        '{prenom}': contact.name.split(' ')[0] || '',
        '{nom_complet}': contact.name,
        '{email}': contact.email
    };

    Object.keys(variables).forEach(variable => {
        content = content.replace(new RegExp(variable, 'g'), variables[variable]);
    });

    return content;
}

// Plus besoin de configuration EmailJS - on utilise le backend SMTP direct
function checkConfig() {
    // Afficher l'application immÃ©diatement
    mainApp.style.display = 'flex';
    initializeApp();
    
    // VÃ©rifier que le serveur backend est accessible (en arriÃ¨re-plan)
    fetch(`${API_URL}/test-smtp`)
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            if (data.success) {
                console.log('âœ… Backend SMTP connectÃ©');
            } else {
                console.warn('âš ï¸ Backend SMTP non disponible:', data.error);
                if (isLocal) {
                    console.warn('ðŸ’¡ Assurez-vous que le serveur local est dÃ©marrÃ© (npm start)');
                } else if (isVercel) {
                    console.warn('ðŸ’¡ VÃ©rifiez que SMTP_PASSWORD est configurÃ© dans Vercel');
                }
            }
        })
        .catch(error => {
            console.error('âŒ Erreur de connexion au backend:', error);
            if (isLocal) {
                console.warn('ðŸ’¡ Le serveur backend local n\'est pas dÃ©marrÃ©. Lancez "npm start"');
            } else if (isVercel) {
                console.warn('ðŸ’¡ VÃ©rifiez la configuration SMTP dans Vercel (Environment Variables)');
            }
            // Ne pas bloquer l'application, juste logger l'erreur
        });
}

// Gestion des conversations
function renderConversations() {
    conversationsList.innerHTML = '';

    conversations.forEach(conversation => {
        const conversationItem = document.createElement('div');
        conversationItem.className = 'conversation-item';
        if (conversation.id === currentConversationId) {
            conversationItem.classList.add('active');
        }

        conversationItem.innerHTML = `
            <div class="conversation-avatar">
                ${getInitials(conversation.contact.name)}
            </div>
            <div class="conversation-info">
                <div class="conversation-name">${conversation.contact.name}</div>
                <div class="conversation-last-message">
                    ${conversation.messages.length > 0 ?
                        conversation.messages[conversation.messages.length - 1].content.substring(0, 30) + '...' :
                        'Nouvelle conversation'
                    }
                </div>
            </div>
            <div class="conversation-time">
                ${conversation.messages.length > 0 ?
                    formatTime(conversation.messages[conversation.messages.length - 1].timestamp) :
                    ''
                }
            </div>
        `;

        conversationItem.addEventListener('click', () => selectConversation(conversation.id));
        conversationsList.appendChild(conversationItem);
    });
}

function selectConversation(conversationId) {
    currentConversationId = conversationId;
    renderConversations();
    renderMessages();

    const conversation = conversations.find(c => c.id === conversationId);
    if (conversation) {
        contactName.textContent = conversation.contact.name;
        contactEmail.textContent = conversation.contact.email;
    }
}

function renderMessages() {
    messagesContainer.innerHTML = '';

    if (!currentConversationId) {
        messagesContainer.innerHTML = `
            <div class="welcome-message">
                <h2>ðŸ‘‹ Bienvenue sur SimplyCRM</h2>
                <p>SÃ©lectionnez une conversation ou crÃ©ez-en une nouvelle pour commencer Ã  envoyer des emails.</p>
            </div>
        `;
        return;
    }

    const conversation = conversations.find(c => c.id === currentConversationId);
    if (!conversation) return;

    conversation.messages.forEach(message => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${message.type}`;

        messageDiv.innerHTML = `
            <div class="message-bubble">
                <div class="message-content">${message.content.replace(/\n/g, '<br>')}</div>
                <div class="message-time">${formatTime(message.timestamp)}</div>
            </div>
        `;

        messagesContainer.appendChild(messageDiv);
    });

    // Scroll to bottom
    messagesContainer.scrollTop = messagesContainer.scrollHeight;
}

function addMessage(conversationId, content, type = 'sent') {
    const conversation = conversations.find(c => c.id === conversationId);
    if (!conversation) return;

    const message = {
        id: generateId(),
        content: content,
        type: type,
        timestamp: new Date().toISOString()
    };

    conversation.messages.push(message);
    saveToLocalStorage();
    renderMessages();
}

function createConversation(contactName, contactEmail) {
    const conversation = {
        id: generateId(),
        contact: {
            name: contactName,
            email: contactEmail
        },
        messages: [],
        createdAt: new Date().toISOString()
    };

    conversations.unshift(conversation);
    saveToLocalStorage();
    renderConversations();
    selectConversation(conversation.id);

    return conversation;
}

// Gestion des templates
function renderTemplates() {
    templatesList.innerHTML = '';

    if (templates.length === 0) {
        const emptyMessage = document.createElement('div');
        emptyMessage.className = 'template-empty';
        emptyMessage.innerHTML = `
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" style="margin-bottom: 12px; opacity: 0.5;">
                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z" fill="#667781"/>
            </svg>
            <p style="color: #667781; font-size: 14px; margin: 0;">Aucun template sauvegardÃ©</p>
            <p style="color: #667781; font-size: 13px; margin: 4px 0 0 0;">CrÃ©ez votre premier template ci-dessus</p>
        `;
        templatesList.appendChild(emptyMessage);
        return;
    }

    templates.forEach(template => {
        const templateItem = document.createElement('div');
        templateItem.className = 'template-item';

        templateItem.innerHTML = `
            <div class="template-name">${template.name}</div>
            <div class="template-preview">${template.content.substring(0, 60)}${template.content.length > 60 ? '...' : ''}</div>
        `;

        templateItem.addEventListener('click', () => useTemplate(template));
        templatesList.appendChild(templateItem);
    });

    // Update broadcast template select
    broadcastTemplate.innerHTML = '<option value="">Choisir un template</option>';
    templates.forEach(template => {
        const option = document.createElement('option');
        option.value = template.id;
        option.textContent = template.name;
        broadcastTemplate.appendChild(option);
    });
}

function saveTemplate(name, content) {
    if (!name || !content) {
        alert('Veuillez remplir tous les champs');
        return;
    }

    const template = {
        id: generateId(),
        name: name,
        content: content,
        createdAt: new Date().toISOString()
    };

    templates.push(template);
    saveToLocalStorage();
    renderTemplates();

    // Clear form
    templateName.value = '';
    templateContent.value = '';
}

function useTemplate(template) {
    if (!currentConversationId) {
        alert('Veuillez d\'abord sÃ©lectionner une conversation');
        return;
    }

    const conversation = conversations.find(c => c.id === currentConversationId);
    const content = replaceTemplateVariables(template.content, conversation.contact);

    messageInput.value = content;
    templatesModal.style.display = 'none';
}

// Envoi d'emails via backend SMTP direct
async function sendEmail(to, subject, content) {
    try {
        const response = await fetch(`${API_URL}/send-email`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                to: to,
                subject: subject || '', // Objet vide si non spÃ©cifiÃ©
                message: content,
                replyTo: 'vianney@stelneo.com'
            })
        });

        // VÃ©rifier le Content-Type avant de parser
        const contentType = response.headers.get('content-type');
        if (!contentType || !contentType.includes('application/json')) {
            const text = await response.text();
            console.error('RÃ©ponse non-JSON reÃ§ue:', text.substring(0, 200));
            throw new Error(`L'API a retournÃ© une rÃ©ponse invalide. VÃ©rifiez que les fonctions serverless sont correctement dÃ©ployÃ©es sur Vercel.`);
        }

        const data = await response.json();

        if (!response.ok) {
            throw new Error(data.error || 'Erreur lors de l\'envoi');
        }

        return { success: true, result: data };
    } catch (error) {
        console.error('Erreur lors de l\'envoi:', error);
        const errorMessage = error.message || error.toString() || 'Erreur inconnue';
        
        // Message d'erreur plus clair selon l'environnement
        if (errorMessage.includes('Failed to fetch') || errorMessage.includes('NetworkError')) {
            if (isLocal) {
                return { 
                    success: false, 
                    error: 'Le serveur backend n\'est pas dÃ©marrÃ©. Lancez "npm start" dans le terminal.' 
                };
            } else if (isVercel) {
                return { 
                    success: false, 
                    error: 'Erreur de connexion. VÃ©rifiez que SMTP_PASSWORD est configurÃ© dans Vercel (Settings â†’ Environment Variables) et redÃ©ployez.' 
                };
            } else {
                return { 
                    success: false, 
                    error: 'Erreur de connexion au serveur backend.' 
                };
            }
        }
        
        return { success: false, error: errorMessage };
    }
}

async function sendMessage() {
    const content = messageInput.value.trim();
    if (!content || !currentConversationId) return;

    const conversation = conversations.find(c => c.id === currentConversationId);
    if (!conversation) return;

    // RÃ©cupÃ©rer l'objet (optionnel) - peut Ãªtre vide
    const subject = document.getElementById('subjectInput').value.trim();

    // Add message to UI immediately
    addMessage(currentConversationId, content, 'sent');
    messageInput.value = '';
    messageInput.style.height = '48px'; // RÃ©initialiser la hauteur du textarea
    document.getElementById('subjectInput').value = ''; // RÃ©initialiser l'objet aprÃ¨s envoi

    // Send email avec l'objet personnalisÃ© (vide si non spÃ©cifiÃ©)
    const result = await sendEmail(
        conversation.contact.email,
        subject, // Peut Ãªtre vide, l'API gÃ©rera
        content
    );

    if (!result.success) {
        alert(`Erreur lors de l'envoi: ${result.error}`);
        // Remove the message from UI if sending failed
        conversation.messages.pop();
        renderMessages();
    }
}

// Broadcast functionality
async function sendBroadcast() {
    const templateId = broadcastTemplate.value;
    const emailsText = broadcastEmails.value.trim();

    if (!templateId || !emailsText) {
        alert('Veuillez sÃ©lectionner un template et saisir des emails');
        return;
    }

    const template = templates.find(t => t.id === templateId);
    if (!template) return;

    // Parse emails
    const emails = emailsText.split(/[\n,]/).map(email => email.trim()).filter(email => email);

    // Afficher la section des rÃ©sultats
    const resultsSection = document.getElementById('broadcastResults');
    resultsSection.style.display = 'block';
    resultsSection.querySelector('h4').textContent = `RÃ©sultats de l'envoi (${emails.length} email${emails.length > 1 ? 's' : ''})`;
    
    // Vider les rÃ©sultats prÃ©cÃ©dents
    const resultsContainer = resultsSection;
    const resultsList = Array.from(resultsContainer.children).filter(child => child.classList.contains('result-item'));
    resultsList.forEach(item => item.remove());

    // DÃ©sactiver le bouton pendant l'envoi
    const sendBtn = document.getElementById('sendBroadcastBtn');
    const originalText = sendBtn.innerHTML;
    sendBtn.disabled = true;
    sendBtn.style.opacity = '0.6';
    sendBtn.innerHTML = '<span>Envoi en cours...</span>';

    let successCount = 0;
    let errorCount = 0;

    for (const email of emails) {
        if (!email.includes('@')) {
            const resultItem = document.createElement('div');
            resultItem.className = 'result-item error';
            resultItem.textContent = `${email}: Email invalide`;
            resultsContainer.appendChild(resultItem);
            errorCount++;
            continue;
        }

        // Create conversation if it doesn't exist
        let conversation = conversations.find(c => c.contact.email === email);
        if (!conversation) {
            // Extract name from email if possible, otherwise use email as name
            const name = email.split('@')[0].replace(/[._-]/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
            conversation = createConversation(name, email);
        }

        const content = replaceTemplateVariables(template.content, conversation.contact);
        addMessage(conversation.id, content, 'sent');

        const result = await sendEmail(
            email,
            `Message de ${conversation.contact.name}`,
            content
        );

        const resultItem = document.createElement('div');
        resultItem.className = `result-item ${result.success ? 'success' : 'error'}`;
        resultItem.textContent = `${email}: ${result.success ? 'âœ“ EnvoyÃ© avec succÃ¨s' : 'âœ— Erreur - ' + result.error}`;
        resultsContainer.appendChild(resultItem);

        if (result.success) {
            successCount++;
        } else {
            errorCount++;
        }
    }

    // RÃ©activer le bouton
    sendBtn.disabled = false;
    sendBtn.style.opacity = '1';
    sendBtn.innerHTML = originalText;

    // Afficher le rÃ©sumÃ©
    const summary = document.createElement('div');
    summary.className = 'result-item success';
    summary.style.marginTop = '12px';
    summary.style.fontWeight = '500';
    summary.textContent = `RÃ©sumÃ©: ${successCount} envoyÃ©${successCount > 1 ? 's' : ''}, ${errorCount} erreur${errorCount > 1 ? 's' : ''}`;
    resultsContainer.appendChild(summary);

    renderConversations();
}

// Event listeners
function initializeApp() {
    renderConversations();
    renderTemplates();

    // Initialiser la hauteur du textarea
    messageInput.style.height = '48px';

    // Fonction pour auto-ajuster la hauteur du textarea
    function autoResizeTextarea(textarea) {
        textarea.style.height = 'auto';
        const newHeight = Math.min(Math.max(textarea.scrollHeight, 48), 200);
        textarea.style.height = newHeight + 'px';
    }

    // Message sending
    sendBtn.addEventListener('click', sendMessage);
    
    // Auto-ajuster la hauteur du textarea
    messageInput.addEventListener('input', function() {
        autoResizeTextarea(this);
    });
    
    // Envoyer avec Ctrl+Enter ou Cmd+Enter, Enter seul crÃ©e une nouvelle ligne
    messageInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
            e.preventDefault();
            sendMessage();
        }
    });
    
    // Permettre d'envoyer avec EntrÃ©e depuis le champ objet
    const subjectInput = document.getElementById('subjectInput');
    subjectInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
            e.preventDefault(); // EmpÃªcher le saut de ligne
            messageInput.focus(); // Passer au champ message
        }
    });

    // Search
    searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase();
        const conversationItems = document.querySelectorAll('.conversation-item');

        conversationItems.forEach(item => {
            const name = item.querySelector('.conversation-name').textContent.toLowerCase();
            const email = conversations.find(c =>
                c.contact.name === item.querySelector('.conversation-name').textContent
            )?.contact.email.toLowerCase() || '';

            if (name.includes(searchTerm) || email.includes(searchTerm)) {
                item.style.display = 'flex';
            } else {
                item.style.display = 'none';
            }
        });
    });

    // Modal controls
    document.getElementById('templatesBtn').addEventListener('click', () => {
        templatesModal.style.display = 'block';
    });

    document.getElementById('broadcastBtn').addEventListener('click', () => {
        broadcastModal.style.display = 'block';
    });

    document.getElementById('newChatBtn').addEventListener('click', () => {
        newChatModal.style.display = 'block';
    });

    document.querySelectorAll('.close-modal').forEach(btn => {
        btn.addEventListener('click', function() {
            this.closest('.modal').style.display = 'none';
        });
    });

    // Template functionality
    saveTemplateBtn.addEventListener('click', () => {
        saveTemplate(templateName.value, templateContent.value);
    });

    // Broadcast functionality
    sendBroadcastBtn.addEventListener('click', sendBroadcast);

    // New chat functionality
    createChatBtn.addEventListener('click', () => {
        const name = newContactName.value.trim();
        const email = newContactEmail.value.trim();

        if (!name || !email) {
            alert('Veuillez remplir tous les champs');
            return;
        }

        if (!email.includes('@')) {
            alert('Veuillez saisir un email valide');
            return;
        }

        createConversation(name, email);
        newChatModal.style.display = 'none';
        newContactName.value = '';
        newContactEmail.value = '';
    });

    // Quick template button
    document.getElementById('templateQuickBtn').addEventListener('click', () => {
        if (templates.length === 0) {
            alert('Aucun template disponible. CrÃ©ez-en un d\'abord.');
            return;
        }

        // Show a simple template selector
        const templateSelect = document.createElement('select');
        templateSelect.innerHTML = '<option value="">Choisir un template</option>';
        templates.forEach(template => {
            const option = document.createElement('option');
            option.value = template.id;
            option.textContent = template.name;
            templateSelect.appendChild(option);
        });

        templateSelect.addEventListener('change', function() {
            const template = templates.find(t => t.id === this.value);
            if (template && currentConversationId) {
                const conversation = conversations.find(c => c.id === currentConversationId);
                const content = replaceTemplateVariables(template.content, conversation.contact);
                messageInput.value = content;
            }
            templateSelect.remove();
        });

        messageInput.parentNode.insertBefore(templateSelect, messageInput);
        templateSelect.focus();
    });

    // Close modals when clicking outside
    window.addEventListener('click', function(e) {
        if (e.target.classList.contains('modal')) {
            e.target.style.display = 'none';
        }
    });
}

// Initialize the app
document.addEventListener('DOMContentLoaded', checkConfig);
    </script>
</body>
</html>
